{"version":3,"file":"2-eval.js","names":["wrap","fn","e","evalStage","cache","code","options","log","createCustomDebug","getFileIdx","filename","evaluated","evaluate","linariaPreval","hasLinariaPreval","value","__linariaPreval","undefined","valueCache","Map","Object","entries","forEach","key","lazyValue","set","JSON","stringify","dependencies"],"sources":["../../src/transform-stages/2-eval.ts"],"sourcesContent":["import { createCustomDebug } from '@linaria/logger';\nimport type { ValueCache } from '@linaria/tags';\nimport { getFileIdx } from '@linaria/utils';\n\nimport type { TransformCacheCollection } from '../cache';\nimport evaluate from '../evaluators';\nimport type { Options } from '../types';\nimport hasLinariaPreval from '../utils/hasLinariaPreval';\n\nconst wrap = <T>(fn: () => T): T | Error => {\n  try {\n    return fn();\n  } catch (e) {\n    return e as Error;\n  }\n};\n\n/**\n * Evaluates template dependencies.\n */\nexport default function evalStage(\n  cache: TransformCacheCollection,\n  code: string,\n  options: Pick<Options, 'filename' | 'pluginOptions'>\n): [ValueCache, string[]] | null {\n  const log = createCustomDebug('transform', getFileIdx(options.filename));\n\n  log('stage-2', `>> evaluate __linariaPreval`);\n\n  const evaluated = evaluate(cache, code, options);\n\n  const linariaPreval = hasLinariaPreval(evaluated.value)\n    ? evaluated.value.__linariaPreval\n    : undefined;\n\n  if (!linariaPreval) {\n    return null;\n  }\n\n  const valueCache: ValueCache = new Map();\n  Object.entries(linariaPreval).forEach(([key, lazyValue]) => {\n    const value = wrap(lazyValue);\n    valueCache.set(key, value);\n  });\n\n  log('stage-2', `<< evaluated __linariaPreval`, () =>\n    JSON.stringify(valueCache)\n  );\n\n  return [valueCache, evaluated.dependencies];\n}\n"],"mappings":";;;;;;AAAA;AAEA;AAGA;AAEA;AAAyD;AAEzD,MAAMA,IAAI,GAAOC,EAAW,IAAgB;EAC1C,IAAI;IACF,OAAOA,EAAE,EAAE;EACb,CAAC,CAAC,OAAOC,CAAC,EAAE;IACV,OAAOA,CAAC;EACV;AACF,CAAC;;AAED;AACA;AACA;AACe,SAASC,SAAS,CAC/BC,KAA+B,EAC/BC,IAAY,EACZC,OAAoD,EACrB;EAC/B,MAAMC,GAAG,GAAG,IAAAC,yBAAiB,EAAC,WAAW,EAAE,IAAAC,iBAAU,EAACH,OAAO,CAACI,QAAQ,CAAC,CAAC;EAExEH,GAAG,CAAC,SAAS,EAAG,6BAA4B,CAAC;EAE7C,MAAMI,SAAS,GAAG,IAAAC,mBAAQ,EAACR,KAAK,EAAEC,IAAI,EAAEC,OAAO,CAAC;EAEhD,MAAMO,aAAa,GAAG,IAAAC,yBAAgB,EAACH,SAAS,CAACI,KAAK,CAAC,GACnDJ,SAAS,CAACI,KAAK,CAACC,eAAe,GAC/BC,SAAS;EAEb,IAAI,CAACJ,aAAa,EAAE;IAClB,OAAO,IAAI;EACb;EAEA,MAAMK,UAAsB,GAAG,IAAIC,GAAG,EAAE;EACxCC,MAAM,CAACC,OAAO,CAACR,aAAa,CAAC,CAACS,OAAO,CAAC,CAAC,CAACC,GAAG,EAAEC,SAAS,CAAC,KAAK;IAC1D,MAAMT,KAAK,GAAGf,IAAI,CAACwB,SAAS,CAAC;IAC7BN,UAAU,CAACO,GAAG,CAACF,GAAG,EAAER,KAAK,CAAC;EAC5B,CAAC,CAAC;EAEFR,GAAG,CAAC,SAAS,EAAG,8BAA6B,EAAE,MAC7CmB,IAAI,CAACC,SAAS,CAACT,UAAU,CAAC,CAC3B;EAED,OAAO,CAACA,UAAU,EAAEP,SAAS,CAACiB,YAAY,CAAC;AAC7C"}